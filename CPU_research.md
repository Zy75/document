# ここ５年間CPUの性能が頭打ちになっている
2017.10

シミュレーションや人工知能の計算をするために、速いPCを新調しようと思った。
ところが、CPUのベンチマークを見ると、候補の製品には現在使用中のCPUの1.4倍の性能（速度）しかないことが分かった。

## CPU

クロックスピードを上げることで、性能が上がった時期があった。
発熱の問題でクロックスピードが上げられなくなり、コア数を増やして並列計算するようになった。

だが、ここ５年、デスクトップ用のPCのコア数は４からあまり伸びていない。

## Passmarkのスコア

PassmarkというベンチマークソフトでCPUの性能を測ることができる。

整数の計算、浮動小数点の計算、などの個別の数値から総合値が計算される。
この総合値は、ネットで公開されている。

調べた所、計算時間は総合値に反比例するようだ。つまり、この数値がx倍であれば、計算時間はx分の１になる。
ただ、計算時間には他にも要因はあり、これは数値のコンセプト的な話だ。

たとえば、CPUバウンドな処理では、確かに計算時間は数値に反比例する。


## 周波数（クロック）とコア数で決まる

ネットのPassmarkの結果を見ると、CPUのスコアはクロックスピードとコア数でだいたい決まる気がする。

score = 比例定数×クロック×実質コア数

実質的なコア数は、並列化の限界から、コア数（スレッド数）から割り引く必要がある。自分では、0.7倍ぐらいにしている。

もちろん、この性能評価法は２０％ぐらいの誤差は出るアバウトな方法だ。

発売年が大きく違うと、アーキテクチャの違いが大きくなるかもしれない。

## 頭打ちの理由

このページをまとめる。
http://forum.notebookreview.com/threads/why-arent-cpus-getting-faster.797265/

- 必要がない。今の性能で不満がないユーザーが多いのかもしれない。

- 競争がない。Intelの競争相手が弱体化した。

- 長く開発されて、伸びしろが減った。

- 研究開発に金がかかる。

- GPUと統合することに力を使っている。

- 消費電力を下げることが大事。

## 微細化

ところで、微細化できるようになって、空いたスペースをどう活用しているのか疑問に思った。

調べてみると、キャッシュメモリが大きくなった、パイプラインなど既存の部分を改良した、GPUを取り込んだ、などが出てきた。
でも、最大トランジスタ数を活用するわけでもないようだ。

## マルチコアはなぜクロックを上げるより得なのか

CMOSの回路に存在する負荷容量が、スイッチングによって充電、放電されると電力が消費される。

その消費電力は、alpha * C * Vdd^2 * f / 2　で表される。　alphaはスイッチングするトランジスタの割合で、この説明では1とする。Cは負荷容量。Vddは電源電圧。fはクロック周波数。

### マルチコア化の場合

まず、１コアを２コアにすると、プロセッサの面積は２倍になる。負荷容量Ｃは面積に比例するので２倍になる。

そこで、クロックfを下げる。
クロックを下げることで、リーク電流が増えるせいで下げられなかった電源電圧Vddも下げられるようになる。
そうすると、（Vddの二乗とfの一乗を含むため）消費電力はfの３乗で下げられる。
fを0.8倍にすれば、３乗で0.512倍になり、Ｃが二倍になった分を打ち消して消費電力は２コアにしても変わらない。

結局、性能は単純計算で0.8×2で1.6倍になっている上に、消費電力は変わらない。

### クロックを上げる場合

一方クロックを上げると、性能は上がるが、クロックの３乗に比例して消費電力が増えてしまう。

参考：「プロセッサを支える技術」Hisa Ando著

ネットにも同著者の解説記事がある。
http://news.mynavi.jp/column/architecture/001/

## パソコンが売れない

あまり自信はないが、CPUの性能が頭打ちなのでユーザーはPCを買い換える必要を感じず、それがPCが売れない理由の一つだ思った。
